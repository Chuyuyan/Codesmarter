# 📤 文件上传功能使用指南

## ✅ 功能已实现

现在用户可以通过**上传 ZIP 文件**来索引仓库，无需输入路径！

---

## 🎯 使用方法

### **步骤 1: 压缩文件夹**

1. 在 Windows 上：
   - 右键点击您的项目文件夹
   - 选择 "发送到" → "压缩(zipped)文件夹"
   - 或者使用 7-Zip/WinRAR 等工具压缩为 ZIP

2. 在 Mac 上：
   - 右键点击文件夹 → "压缩项目"

3. 在 Linux 上：
   ```bash
   zip -r my-project.zip my-project/
   ```

### **步骤 2: 上传并索引**

1. 打开网页界面
2. 在 "Index Repository" 部分，默认显示 **"📤 Upload Folder (ZIP)"** 标签页
3. 点击 "选择文件" 或拖拽 ZIP 文件
4. （可选）输入仓库名称
5. 点击 "Upload and Index" 按钮
6. 等待上传和索引完成

---

## 🔧 技术实现

### **后端 (`backend/app.py`)**

新增端点：`POST /upload_and_index`

**功能：**
- ✅ 接收 ZIP 文件上传
- ✅ 验证文件格式（仅 ZIP）
- ✅ 解压 ZIP 文件
- ✅ 自动检测仓库根目录
- ✅ 索引解压后的代码
- ✅ 关联到用户账户
- ✅ 清理临时 ZIP 文件（保留解压内容）

**文件大小限制：** 100MB（前端验证）

**存储位置：** `data/uploads/{upload_id}/`

---

### **前端 (`static/index.html`, `static/js/app.js`)**

**新增功能：**
- ✅ 标签页切换（上传 vs 路径输入）
- ✅ 文件选择器（仅接受 .zip）
- ✅ 文件大小验证（100MB）
- ✅ 上传进度显示
- ✅ 双语支持（中英文）

**UI 改进：**
- 默认显示上传标签页（更用户友好）
- 路径输入作为备选方案（适用于 Docker/服务器环境）

---

## 📋 功能对比

| 功能 | 文件上传 | 路径输入 |
|------|---------|---------|
| **跨平台** | ✅ 是 | ❌ 否（路径问题） |
| **Docker 兼容** | ✅ 是 | ⚠️ 需要配置卷 |
| **用户友好** | ✅ 非常友好 | ⚠️ 需要知道路径 |
| **适用场景** | 所有用户 | 服务器环境 |

---

## 🎨 界面预览

```
┌─────────────────────────────────────┐
│ 📚 Index Repository                  │
├─────────────────────────────────────┤
│ [📤 Upload Folder (ZIP)] [📁 Path] │
│                                     │
│ Upload ZIP File:                    │
│ [选择文件] my-project.zip           │
│ ℹ️ Compress your folder as ZIP      │
│                                     │
│ Repository Name (optional):         │
│ [________________]                  │
│                                     │
│ [Upload and Index]                 │
└─────────────────────────────────────┘
```

---

## ⚠️ 注意事项

1. **文件大小限制：** 100MB
   - 如果项目太大，建议：
     - 删除 `node_modules`, `.git` 等大文件夹
     - 使用 `.gitignore` 排除不需要的文件

2. **ZIP 文件结构：**
   - 如果 ZIP 内只有一个文件夹，会自动使用该文件夹作为根目录
   - 如果 ZIP 内有多个文件/文件夹，使用 ZIP 根目录

3. **存储：**
   - 上传的文件会保存在 `data/uploads/` 目录
   - ZIP 文件会在解压后自动删除（节省空间）
   - 解压后的代码会保留用于索引

4. **安全性：**
   - 文件会关联到用户账户
   - 只有上传者可以访问自己的仓库
   - 文件名会经过安全处理（防止路径遍历）

---

## 🚀 下一步优化建议

1. **进度条：** 显示上传和索引进度
2. **Git URL：** 支持直接输入 Git 仓库 URL
3. **拖拽上传：** 支持拖拽文件到浏览器
4. **批量上传：** 支持一次上传多个 ZIP 文件
5. **自动清理：** 定期清理旧的上传文件

---

## 📝 测试步骤

1. 创建一个测试项目文件夹
2. 压缩为 ZIP
3. 登录网页界面
4. 切换到 "Upload Folder (ZIP)" 标签页
5. 选择 ZIP 文件
6. 点击 "Upload and Index"
7. 等待完成
8. 尝试提问测试索引是否成功

---

## ✅ 完成状态

- [x] 后端上传端点
- [x] ZIP 解压功能
- [x] 前端 UI（标签页）
- [x] 文件验证
- [x] 用户关联
- [x] 双语支持
- [x] 错误处理

**功能已完全实现，可以开始使用！** 🎉

